<?xml version="1.0"?>
<!-- 考勤相关sql -->
<Scheme>
	<!-- 打卡 -->
	<select id="scanning">
		insert into
		t_attendance(user_id,time,photo,project_id,parent_id,root_id,address,longitude,latitude,normal,status)
		values('#user_id#',to_date('#time#','yyyy-MM-dd
		HH24:mi:ss'),'#photo#','#project_id#','#parent_id#','#root_id#','#address#','#longitude#','#latitude#','#normal#','#status#')
	</select>
	<!-- 查询今天有没有考勤数据 -->
	<select id="query_project_attendance_for_today">
		select * from t_attendance
		where 1=1
		[and project_id='#project_id#']
		[and to_char(time,'yyyy-mm-dd')='#date#']
	</select>
	<!-- 查询今天有没有有效的考勤数据 -->
	<select id="query_project_vaild_attendance_for_today">
		select * from t_attendance
		where 1=1
		and photo != ''
		and photo != 'null'
		[and project_id='#project_id#']
		[and to_char(time,'yyyy-mm-dd')='#date#']
	</select>
	<!-- 更新考勤数据 -->
	<select id="update_scanning">
		update t_attendance
		set time=to_date('#time#','yyyy-MM-dd HH24:mi:ss'),
		photo='#photo#',address='#address#',longitude='#longitude#',latitude='#latitude#',normal='#normal#',status='#status#'
		where 1=1
		[and project_id='#project_id#']
		[and to_char(time,'yyyy-mm-dd')='#date#']
	</select>
</Scheme>
